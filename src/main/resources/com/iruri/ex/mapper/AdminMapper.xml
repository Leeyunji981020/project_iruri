<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.iruri.ex.mapper.AdminMapper">

	<resultMap type="com.iruri.ex.vo.ReportVO" id="reportMap">
		<result property="boardId" column="BOARD_ID" />
		<result property="reportContent" column="REPORT_CONTENT" />
		<result property="reportDate" column="REPORT_DATE" />
		<result property="reportId" column="REPORT_ID" />
		<result property="userId" column="USER_ID" />
		<result property="reportUserNickName" column="user_nickname" />
		<result property="reportUserRoll" column="auth_content" />
		
		<!-- <collection property="reportList" resultMap="reportMap">
		</collection> -->
	</resultMap>

	<!-- <resultMap type="com.iruri.ex.vo.AuthVO" id="authMap"> <result property="authNumber" 
		column="auth_number"/> <result property="authId" column="auth_id"/> <result 
		property="authContent" column="auth_content"/> <result property="userId" 
		column="user_id"/> </resultMap> -->


	<!-- 신고들어온 게시글(신고알림) 리스트 -->
	<!-- 1.페이징처리 안된 리스트 -->
	<select id="getReportList" resultMap="reportMap">
		<![CDATA[
		select r.*, c.user_nickname, c.auth_content 
		from report r,
		    (select b.board_id, u.user_id, u.user_nickname, u.auth_content 
			from board b, 
				(select distinct iuser.user_id as user_id, iuser.user_nickname as user_nickname, 
		        	     authority.auth_content as auth_content
		     	from authority, iuser 
		     	where authority.user_id = iuser.user_id) u
			where b.user_id = u.user_id order by b.board_id desc) c
		where r.board_id = c.board_id order by report_id desc
		]]>
	</select>
	
	<!-- 2.페이징처리 리스트-->
	<select id="getReportListWithPaging" resultMap="reportMap">
		<![CDATA[
		select *
			from (
			select rownum rn, d.* from (select r.*, c.user_nickname, c.auth_content 
			from report r,
			    (select b.board_id, u.user_id, u.user_nickname, u.auth_content 
				from board b, (select distinct iuser.user_id as user_id, iuser.user_nickname as user_nickname, 
				                authority.auth_content as auth_content
				     from authority, iuser 
				     where authority.user_id = iuser.user_id) u
				where b.user_id = u.user_id order by b.board_id desc) c
				where r.board_id = c.board_id order by report_id desc) d
			where rownum <= #{pageNum} * #{amount}
			)
		where rn > (#{pageNum} - 1) * #{amount}
		]]>
	</select>

	<!-- 3.리스트 갯수 -->
	<select id="countReportId" resultType="int">
		<![CDATA[
		select count(REPORT_ID) from report
		]]>
	</select>
	


</mapper>